<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Lab 4 – UW/Seattle Map Tiles</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.18.1/mapbox-gl.css" rel="stylesheet">
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.18.1/mapbox-gl.js"></script>
  <style>
    body { margin: 0; padding: 0; font-family: system-ui, sans-serif; }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; }
    #title-bar { position: absolute; top: 10px; left: 10px; z-index: 2; background: rgba(255,255,255,0.95); padding: 12px; border-radius: 6px; max-width: 320px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
    #title-bar h1 { margin: 0 0 6px 0; font-size: 16px; }
    #title-bar p { margin: 0; font-size: 13px; line-height: 1.4; }
    #layer-menu { position: absolute; top: 10px; right: 10px; z-index: 2; background: rgba(255,255,255,0.95); padding: 12px; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
    #layer-menu label { display: block; cursor: pointer; margin-bottom: 8px; font-size: 13px; }
    #info-panel { position: absolute; bottom: 10px; left: 10px; z-index: 2; background: rgba(0,0,0,0.85); color: white; padding: 14px; border-radius: 6px; max-width: 300px; font-size: 13px; display: none; }
  </style>
</head>
<body>
  <div id="map"></div>
  <div id="title-bar">
    <h1>Lab 4 – Seattle/UW Thematic Map</h1>
    <p>4 tile sets: monochrome basemap, neighborhoods choropleth, parks/buildings, UW theme. Hover/click for info.</p>
  </div>
  <div id="layer-menu">
    <strong>Layers</strong>
    <label><input type="checkbox" id="toggle-basemap" checked> 1. Basemap (Monochrome)</label>
    <label><input type="checkbox" id="toggle-neighborhoods" checked> 2. Neighborhoods</label>
    <label><input type="checkbox" id="toggle-parks" checked> Parks</label>
    <label><input type="checkbox" id="toggle-buildings" checked> UW Buildings</label>
    <label><input type="checkbox" id="toggle-theme" checked> 4. UW Theme (3D)</label>
  </div>
  <div id="info-panel">
    <strong id="feature-name"></strong><br>
    <span id="feature-info"></span>
  </div>

  <script>
    mapboxgl.accessToken = 'NEW_TOKEN_HERE';  // ← Paste your NEW token!

    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/light-v11',
      center: [-122.305, 47.655],
      zoom: 14, minZoom: 11, maxZoom: 18
    });

    map.addControl(new mapboxgl.NavigationControl());
    map.addControl(new mapboxgl.ScaleControl({ unit: 'metric' }));

    map.on('load', () => {
      // TILE SET 1: Custom monochrome basemap
      map.setPaintProperty('water', 'fill-color', '#e9f2ff');
      map.setPaintProperty('road-fill-primary', 'fill-color', '#e0e0e0');
      map.setPaintProperty('road-label', 'text-font', ['Open Sans Regular', 'Arial Unicode MS Regular']);

      // TILE SET 2: Thematic GeoJSON
      map.addSource('neighborhoods', { type: 'geojson', data: 'assets/2016_seattle_neighborhoods.geojson' });
      map.addLayer({
        id: 'neighborhoods-layer',
        type: 'fill',
        source: 'neighborhoods',
        paint: {
          'fill-color': ['interpolate', ['linear'], ['get', 'POPULATION'] || ['get', 'pop'] || 0, 0, '#f7fbff', 50000, '#08519c'],
          'fill-opacity': 0.7,
          'fill-outline-color': '#bdc3c7'
        }
      });

      map.addSource('parks', { type: 'geojson', data: 'assets/Park_Boundaries_3221989587705057109.geojson' });
      map.addLayer({
        id: 'parks-layer',
        type: 'line',
        source: 'parks',
        paint: { 'line-color': '#27ae60', 'line-width': 3 }
      });

      map.addSource('buildings', { type: 'geojson', data: 'assets/Buildings result.geojson' });
      map.addLayer({
        id: 'buildings-layer',
        type: 'circle',
        source: 'buildings',
        paint: { 'circle-radius': 5, 'circle-color': '#8e44ad', 'circle-stroke-color': 'white', 'circle-stroke-width': 2 }
      });

      // TILE SET 4: UW Theme (3D buildings)
      map.addLayer({
        id: 'theme-layer',
        type: 'fill-extrusion',
        source: 'buildings',
        paint: {
          'fill-extrusion-color': '#8e44ad',
          'fill-extrusion-height': ['get', 'HEIGHT'] || 20,
          'fill-extrusion-base': 0,
          'fill-extrusion-opacity': 0.9
        }
      });

      // Layer order
      ['neighborhoods-layer', 'parks-layer', 'buildings-layer', 'theme-layer'].forEach(id => map.moveLayer(id));

      // Hover/click info
      const layers = ['neighborhoods-layer', 'parks-layer', 'buildings-layer'];
      layers.forEach(layerId => {
        map.on('mouseenter', layerId, (e) => showInfo(e.features[0]));
        map.on('click', layerId, (e) => showInfo(e.features[0]));
      });
    });

    function showInfo(feature) {
      document.getElementById('info-panel').style.display = 'block';
      document.getElementById('feature-name').textContent = feature.properties.NAME || feature.properties.name || 'Feature';
      document.getElementById('feature-info').textContent = 
        Object.entries(feature.properties).slice(0,4).map(([k,v]) => `${k}: ${v}`).join(', ');
    }

    // Layer switcher
    document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
      cb.addEventListener('change', (e) => {
        const layerId = e.target.id.replace('toggle-', '') + '-layer';
        if (map.getLayer(layerId)) map.setLayoutProperty(layerId, 'visibility', e.target.checked ? 'visible' : 'none');
      });
    });
  </script>
</body>
</html>
